{% extends 'base_nhaquote.html' %}

{% load i18n static humanize hp_tags %}

{% block title %}
    {% if form_data.Ins_Type == 'stm' %}
        {% trans 'STM Plans' %}
    {% elif form_data.Ins_Type == 'lim' %}
        {% trans 'LIM Plans' %}
    {% elif form_data.Ins_Type == 'anc' %}
        {% trans 'Ancilliary Plans' %}
    {% endif %}
    | {{ block.super }}
{% endblock title %}

{% block extra_css %}
    <style>
        .quote-tab-info-wrapper>.quote-tab-info-line>li{
            width: 100%;
        }
        .quote-tab-info-wrapper>.quote-tab-info-line>li>a{
            margin: 0;
            border-radius: 0;
        }
        .quote-tab-info-wrapper>.quote-tab-info-line>li.active>a{
            background-color: #19B4FA;
            color: #fff;
        }
        .quote-tab-info-line {
            border: 1px solid #19B4FA;
            {#margin: 0 15px;#}
            padding: 0;
            display: block;
        }
        .overlay-loading {
            display: none;
            width: 100vw;
            height: 100vh;
            top: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 99999;
            position: fixed;
            font-size: 50px;
            font-weight: bold;
            color: #fff;
            text-align: center;
            line-height: 100vh;
        }
        .overlay-loading img{
            width: 65px;
        }
        @media (min-width: 1023px) {
            .quote-tab-info-wrapper > .quote-tab-info-line > li {
                width: auto;
            }
            .quote-tab-info-wrapper {
                display: -webkit-box;
                display: -ms-flexbox;
                display: flex;
                -webkit-box-align: center;
                -ms-flex-align: center;
                align-items: center;
                -webkit-box-pack: justify;
                -ms-flex-pack: justify;
                justify-content: space-between
            }
        }
        .row-eq-height, .row-eq-height > [class*='col-'] {
            display: -webkit-box;
            display: -webkit-flex;
            display: -ms-flexbox;
            display: flex;
        }
        .row-eq-height {
            flex-wrap: wrap;
        }
        .row-eq-height > [class*='col-'] {
            flex-direction: column;
        }
        #filter-sort {
            position: absolute;
            background: #fff;
            width: calc(100% + 2px);
            z-index: 15;
            left: 0;
            top: 55px;
            border: 1px solid #e7e7e7;
            border-top: 0;
            padding-bottom: 20px;
            -webkit-box-shadow: 0 5px 8px 0 rgba(0, 0, 0, 0.3);
            -moz-box-shadow: 0 5px 8px 0 rgba(0, 0, 0, 0.3);
            box-shadow: 0 5px 8px 0 rgba(0, 0, 0, 0.3);
        }
        .quote-sort-bar {
            position: relative;
        }
        @media (max-width: 775px) {
            #filter-sort .row-eq-height .col-md-3 {
                width: 100%;
            }
        }
        .qt-each-plan{
            margin-left:auto;
            margin-right:auto;
        }
        #filter-sort .row-eq-height .custom-check-holder {
            border: 1px solid #fe8829;
            border-radius: 5px;
            margin: 0 3px 20px;
        }
        .quote-filter-title {
            border: 0;
            background: #fe8829;
            color: #fff;
            padding: 15px 20px;
        }
        .custom-check-holder {
            padding-top: 0;
        }
        .quote-filter-title span.info-icn {
            right: 10px;
            color: #fe8829;
            border: none;
            font-size: 19px;
            box-shadow: 0 0 3px 1px rgba(0, 0, 0, 0.55);
        }
        ul.custom-radio, ul.custom-check {
            padding: 0 16px;
        }
        i.fa.fa-caret-down {
            display: none;
        }
        .qt-sticky {
            position: fixed;
            top: 0;
            z-index: 20;
            width: 100%;
            left: 0;
            box-shadow: 0 0 20px 6px rgba(0, 0, 0, 0.48);
        }
        .qt-quote-loading-icon {
            text-align: center;
            margin-top: 50px;
            width: 100%;
        }
        #month_plan_list {
            min-height: calc(100vh - 634px);
            margin-left: -15px;
            margin-right: -15px;
        }
        .no-coverage-error-wrapper {
            margin: 0 15px;
            padding-top: 30px;
            padding-bottom: 30px;
            display: inline-table;
        }
        .no-coverage-error {
            margin: 0;
        }
    </style>
{% endblock extra_css %}

{% block container %}
    <div class="quote-info-bar">
        <div class="container">
            <div class="">
                <div class="quote-tab-info-wrapper">
                    <ul class="nav nav-tabs quote-tab-info-line">
                        <li class="{% if form_data.Ins_Type == 'lim' %}active{% endif %}"><a href="{% url 'quotes:plan_quote' ins_type='lim' %}">Limited Insurances</a></li>
                        <li class="{% if form_data.Ins_Type == 'stm' %}active{% endif %}"><a href="{% url 'quotes:plan_quote' ins_type='stm' %}">STM Insurances</a></li>
                        <li class="{% if form_data.Ins_Type == 'anc' %}active{% endif %}"><a href="{% url 'quotes:plan_quote' ins_type='anc' %}">Ancillary Insurances</a></li>
                    </ul>
                    <div class="quote-info-inner" style="padding: 10px 15px;font-size: 15px;">
                        {% if form_data.Ins_Type == 'lim' %}Limited{% elif form_data.Ins_Type == 'anc' %}Ancillary{% else %}STM{% endif %}
                        / {{ form_data.State }} / {{ form_data.Applicant_Gender }} / {{ form_data.Applicant_Age }}
                        &nbsp;<a title="Get Health Insurance Quotes" href="/#/health-insurance/member" class="js-change-info">(edit)</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="overlay-loading">
        <img src="{% static 'quotes/img/ajax-loader.gif' %}" alt="ajax-loader">
    </div>

    <div class="common-section-npt gray-light-bg">
        <div class="container">
            <div class="row pad-t-25">
                {% comment %}<div class="col-xs-12 mrg-b-15">
                    <div class="quote-header-table">
                        <h1 class="quote-heading">
                            <strong><span id="total_plan_count">0</span> plans found.</strong>
                            Showing <span id="plan_display_count">0</span> plans.
                        </h1>
                    </div>
                </div>{% endcomment %}
                {% comment %}
                <div class="col-xs-12 col-md-4 tl-sm text-right mrg-sm-t-15 mrg-b-15">
                    <div class="quote-compare-heading">
                        <span class="quote-compare-up-to">(up to 4 plans)</span>
                        <a class="js-compare-link quote-compare-link" href="">Compare (<span class="js-compare-count">2</span>)</a>
                    </div>
                </div>
                {% endcomment %}
            </div>
            <div class="row">

                {% comment %}<div class="sidebar-col ms-col" id="filtering_mobile">

                    {# FILTER BUTTON FOR MOBILE #}
                    <div id="filter-btn-wrapper">
                        <button class="btn" id="btn-filter">
                            Filter
                            <span> <i class="fa fa-caret-down"></i></span>
                        </button>
                    </div>

                    <div class="sidebar-col-holder">
                        <h2 class="quote-filter-header">Narrow Your Results</h2>

                                                <div class="custom-check-holder">
                            <h3 class="quote-filter-title">View Plan Options
                                <span class="info-icn"  data-container="body" data-toggle="popover" data-placement="top" data-content="Vivamus sagittis lacus vel augue laoreet rutrum faucibus." ></span>
                            </h3>
                            <ul class="custom-radio">
                                <li>
                                    <input type="radio" name="radiog_dark" id="radio1" class="css-checkbox"/>
                                    <label for="radio1" class="css-label radGroup2">Best Sellers only <span class="quote-filter-count">(5)</span></label>
                                </li>
                                <li>
                                    <input type="radio" name="radiog_dark" id="radio2" class="css-checkbox" checked/>
                                    <label for="radio2" class="css-label radGroup2">Best Sellers only <span class="quote-filter-count">(42)</span></label>
                                </li>
                            </ul>
                        </div>

                    </div>
                </div>{% endcomment %}

                <div class="ms-col col-xs-12">
                    <div class="row">
                        <div class="col-xs-12">
                            <div class="quote-sort-bar ms-row">
                                <div id="narrow-quotes" style="z-index: 20">
                                    <div class="" style="display: flex; justify-content: space-between; align-items: center;">
                                        <p class="mrg-b-0" style="font-weight: bold;"><span id="plan_display_count">0</span> plans</p>
                                        <div id="narrow-toggler-btn" style="">
                                            <button class="btn qt-btn-primary">Filter & Sort</button>
                                        </div>
                                    </div>
                                    <div id="filter-sort" style="display: none;z-index: 15;">
                                        <div style="position: relative;">
                                            <div id="close-fs" class="cur-p" style="color: #fff; font-size: 20px; font-weight: bold;">x</div>

                                            <div class="row-eq-height">
                                                <div class="col-md-3">

                                                    {# COMPANY START #}
                                                    <div class="custom-check-holder">
                                                        <h3 class="quote-filter-title">Company
                                                            <span class="info-icn" data-container="body" data-toggle="popover"
                                                                  data-placement="top"
                                                                  data-content="The company that issues an insurance policy and assumes the risks associated with the insured."></span>
                                                        </h3>
                                                        <ul class="custom-check" id="plan_carrier_list_ul" data-status="loading">
                                                            {% for company in ctx_company_list %}
                                                                {% if form_data.Ins_Type == 'lim' and company in ctx_lim_company_list or form_data.Ins_Type == 'stm' and company in ctx_stm_company_list or form_data.Ins_Type == 'anc' and company in ctx_anc_company_list %}
                                                                    <li class="plan_carrier">
                                                                    <input type="checkbox" name="carrier"
                                                                           id="carrier-{{ company.0 }}"
                                                                           class="filter_input css-checkbox company_filter_value_input"

                                                                           data-status="loading"
                                                                           data-value="{{ company.0 }}" disabled>
                                                                    <label for="carrier-{{ company.0 }}" class="css-label">
                                                                    {{ company.1 }}
                                                                    <span class="quote-filter-count">(<span id="company_total_plan_count_{{ company.0 }}">0</span>)</span>
                                                                {% endif %}
                                                            </label>
                                                            </li>
                                                            {% endfor %}
                                                        </ul>
                                                    </div>
                                                    {# COMPANY END #}
                                                </div>


                                                <div class="col-md-3">
                                                    {# PREMIUM START #}
                                                    <div class="custom-check-holder">
                                                        <h3 class="quote-filter-title">
                                                            {% if form_data.Payment_Option == '1' %}Monthly{% endif %} Premium
                                                            <span class="info-icn" data-container="body" data-placement="top"
                                                                  data-content="Also known as 'Premium', it is the fixed amount you pay to have health insurance. You pay your premium even if you don't receive any medical care. If you have selected the monthly payment option, this is the amount that you must pay monthly. If you have selected the single up-front payment option, this is the total amount of the policy."
                                                                  data-toggle="popover"></span>
                                                        </h3>
                                                        <ul class="custom-radio">
                                                            {% for premium in ctx_monthly_premium_list %}
                                                                <li>
                                                                    <input type="radio" name="priceRange"
                                                                           id="priceRange-{{ premium.0 }}-{{ premium.1 }}"
                                                                           data-filter0="{{ premium.0 }}"
                                                                           data-filter1="{{ premium.1 }}"
                                                                           data-status="loading"
                                                                           class="filter_input css-checkbox premium_filter_range_input"
                                                                            {% if premium.0 == '100' %}{#checked#}{% endif %} disabled>

                                                                    <label for="priceRange-{{ premium.0 }}-{{ premium.1 }}"
                                                                           class="css-label radGroup2">
                                                                        {% if not forloop.first and not forloop.last %}
                                                                            ${{ premium.0|intcomma }} to ${{ premium.1|intcomma }}
                                                                        {% elif forloop.first %}
                                                                            Under ${{ premium.1|intcomma }}
                                                                        {% elif forloop.last %}
                                                                            Above ${{ premium.0|intcomma }}
                                                                        {% endif %}
                                                                        <span class="quote-filter-count">(<span id="premium_total_plan_count_{{ premium.0 }}_{{ premium.1 }}">0</span>)</span>
                                                                    </label>
                                                                </li>
                                                            {% endfor %}
                                                            <li>
                                                                <input type="radio" name="priceRange" id="priceRange-all"
                                                                       class="css-checkbox filter_input"
                                                                       data-status="loading"
                                                                       data-filter0=""
                                                                       data-filter1="" checked>
                                                                <label for="priceRange-all" class="css-label radGroup2">
                                                                    All {% if form_data.Payment_Option == '1' %}Monthly{% endif %} Premium
                                                                    <span class="quote-filter-count">(<span id="premium_total_plan_count">0</span>)</span>
                                                                </label>
                                                            </li>
                                                        </ul>
                                                    </div>
                                                    {# PREMIUM END #}
                                                </div>


                                                <div class="col-md-3">
                                                    {# DEDUCTIBLE START #}
                                                    <div class="custom-check-holder" {% if form_data.Ins_Type == 'lim' or form_data.Ins_Type == 'anc' %} hidden="hidden" {% endif %} >
                                                        <h3 class="quote-filter-title">
                                                            Deductible
                                                            <span class="info-icn" data-container="body" data-toggle="popover" data-placement="top"
                                                                  data-content="The amount you pay before your health insurance plan begins to pay for the services you receive. Not everything you pay (such as your premium and copay) counts toward your deductible. For example, if your deductible is $1,000, your plan won't pay anything until you've met your $1,000 deductible for covered healthcare services subject to the deductible. Estimated Premium is based on a (Per Term Deductible)"></span>
                                                        </h3>
                                                        <ul class="custom-radio" data-status="loading">
                                                            {% for deductible in ctx_deductible_option_list %}
                                                                <li>
                                                                    <input type="radio" name="planDeductibleRange"
                                                                           id="planDeductibleRange-{{ deductible }}"
                                                                           class="filter_input css-checkbox deductible_filter_value_input"
                                                                           data-status="loading"
                                                                           data-value="{{ deductible }}"
                                                                           disabled {% if deductible == '1000' %}{#checked#}{% endif %}>
                                                                    <label for="planDeductibleRange-{{ deductible }}" class="css-label radGroup2">
                                                                        ${{ deductible|intcomma }}
                                                                        <span class="quote-filter-count">(<span id="deductible_total_plan_count_{{ deductible }}">0</span>)</span>
                                                                    </label>
                                                                </li>
                                                            {% endfor %}
                                                            <li>
                                                                <input type="radio" name="planDeductibleRange"
                                                                       id="planDeductibleRange-all"
                                                                       class="filter_input css-checkbox"
                                                                       data-status="loading"
                                                                       data-value="" checked>
                                                                <label for="planDeductibleRange-all" class="css-label radGroup2">
                                                                    All Deductibles
                                                                    <span class="quote-filter-count">(<span id="deductible_total_plan_count">0</span>)</span>
                                                                </label>
                                                            </li>
                                                        </ul>
                                                    </div>
                                                    {# DEDUCTIBLE END #}
                                                </div>



                                                <div class="col-md-3" style="display: none;">
                                            {# COINSURANCE START #}
                                            <div class="custom-check-holder" {% if form_data.Ins_Type == 'lim' or form_data.Ins_Type == 'anc' %} hidden="hidden" {% endif %} >
                                                <h3 class="quote-filter-title">
                                                    Coinsurance
                                                    <span class="info-icn" data-container="body" data-placement="top"
                                                          data-content="Your share of costs for a covered service, typically after you meet your deductible and copayment charges. For example, once you meet your deductible, you might pay 20% and your health insurance plan pays 80%, based on the plan you choose. Once you have met your plan's annual out-of-pocket maximum, your plan pays 100% of the costs for covered services."
                                                          data-toggle="popover"></span>
                                                </h3>
                                                <ul class="custom-radio" data-status="loading">
                                                    {% for coinsurance in ctx_coinsurance_limit_list %}
                                                        <li>
                                                            <input type="radio" name="planCoinsurance"
                                                                   id="planCoinsurance-{{ coinsurance }}"
                                                                   class="filter_input css-checkbox coinsurance_filter_value_input"
                                                                   data-status="loading"
                                                                   data-value="{{ coinsurance }}"
                                                                   disabled {% if coinsurance == '20' %}{#checked#}{% endif %}>
                                                            <label for="planCoinsurance-{{ coinsurance }}" class="css-label radGroup2">
                                                                {{ coinsurance }}%
                                                                <span class="quote-filter-count">(<span id="coinsurance_total_plan_count_{{ coinsurance }}">0</span>)</span>
                                                            </label>
                                                        </li>
                                                    {% endfor %}
                                                    <li>
                                                        <input type="radio" name="planCoinsurance"
                                                               id="planCoinsurance-all"
                                                               class="filter_input css-checkbox"
                                                               data-status="loading"
                                                               data-value="all" checked>
                                                        <label for="planCoinsurance-all" class="css-label radGroup2">
                                                            All Coinsurance
                                                            <span class="quote-filter-count">(<span id="coinsurance_total_plan_count">0</span>)</span>
                                                        </label>
                                                    </li>
                                                </ul>
                                            </div>
                                            {# COINSURANCE END #}
                                                </div>


                                                <div class="col-md-3" style="display: none;">
                                            {# OOP START #}
                                            <div class="custom-check-holder" {% if form_data.Ins_Type == 'lim' or form_data.Ins_Type == 'anc' %} hidden="hidden" {% endif %}>
                                                <h3 class="quote-filter-title">
                                                    Max Out of Pocket
                                                    <span class="info-icn" data-container="body" data-placement="top"
                                                          data-content="The money you pay out of your own pocket when you get medical care.
                                                Out-of-pocket costs include deductibles, coinsurance, and co-payments.
                                                Most health insurance plans have a cap on the total out-of-pocket costs you pay during your coverage period.
                                                This is often called your Max Out-of-Pocket or Out-of-Pocket Max."
                                                          data-toggle="popover"></span>
                                                </h3>
                                                <ul class="custom-radio" data-status="loading">
                                                    {% for oop in ctx_max_out_of_pocket_list %}
                                                        <li>
                                                            <input type="radio" name="oopMaxRange"
                                                                   id="oopMaxRange-{{ oop.0 }}-{{ oop.1 }}"
                                                                   class="filter_input css-checkbox oop_filter_range_input"
                                                                   data-filter0="{{ oop.0 }}"
                                                                   data-filter1="{{ oop.1 }}"
                                                                   data-status="loading"
                                                                   disabled {% if oop.0 == '3500' %}{#checked#}{% endif %}>
                                                            <label for="oopMaxRange-{{ oop.0 }}-{{ oop.1 }}" class="css-label radGroup2">
                                                                {% if not forloop.first and not forloop.last %}
                                                                    ${{ oop.0|intcomma }} to ${{ oop.1|intcomma }}
                                                                {% elif forloop.first %}
                                                                    Under ${{ oop.1|intcomma }}
                                                                {% elif forloop.last %}
                                                                    Above ${{ oop.0|intcomma }}
                                                                {% endif %}
                                                                <span class="quote-filter-count">(<span id="oop_total_plan_count_{{ oop.0 }}_{{ oop.1 }}">0</span>)</span>
                                                            </label>
                                                        </li>
                                                    {% endfor %}
                                                    <li>
                                                        <input type="radio" name="oopMaxRange"
                                                               id="oopMaxRange-all"
                                                               class="filter_input css-checkbox"
                                                               data-filter0=""
                                                               data-filter1=""
                                                               data-status="loading" checked>
                                                        <label for="oopMaxRange-all" class="css-label radGroup2">
                                                            All Max Out of Pocket
                                                            <span class="quote-filter-count">(<span id="oop_total_plan_count">0</span>)</span>
                                                        </label>
                                                    </li>
                                                </ul>
                                            </div>
                                            {# OOP END #}
                                                </div>


                                                <div class="col-md-3" style="display: none;">
                                            {# POLICY_MAX START #}
                                            <div class="custom-check-holder"{% if form_data.Ins_Type == 'lim' or form_data.Ins_Type == 'anc' %} hidden="hidden" {% endif %}>
                                                <h3 class="quote-filter-title">
                                                    Policy Maximum
                                                    <span class="info-icn" data-container="body" data-placement="top"
                                                          data-content="The maximum dollar amount that a health insurance company
                                                              agrees to pay on behalf of a member for covered services
                                                              during the course of the coverage period."
                                                          data-toggle="popover"></span>
                                                </h3>
                                                <ul class="custom-radio" data-status="loading">
                                                    {% for policy_max in ctx_policy_maximum_list %}
                                                        <li>
                                                            <input type="radio" name="planCoverageMax"
                                                                   id="planCoverageMax-{{ policy_max }}"
                                                                   class="filter_input css-checkbox policy_max_filter_value_input"
                                                                   data-status="loading"
                                                                   data-value="{{ policy_max }}" disabled>
                                                            <label for="planCoverageMax-{{ policy_max }}" class="css-label radGroup2">
                                                                ${{ policy_max }}
                                                                <span class="quote-filter-count">(<span id="policy_max_total_plan_count_{{ policy_max }}">0</span>)</span>
                                                            </label>
                                                        </li>
                                                    {% endfor %}
                                                    <li>
                                                        <input type="radio" name="planCoverageMax"
                                                               id="planCoverageMax-all"
                                                               class="filter_input css-checkbox"
                                                               data-status="loading"
                                                               data-value=""
                                                               checked>
                                                        <label for="planCoverageMax-all" class="css-label radGroup2">
                                                            All Policy Maximum
                                                            <span class="quote-filter-count">(<span id="policy_max_total_plan_count">0</span>)</span>
                                                        </label>
                                                    </li>
                                                </ul>
                                            </div>
                                            {# POLICY_MAX END #}
                                                </div>



                                                {% if form_data.Ins_Type == 'stm' %}
                                                    <div class="col-md-3">
                                                        <div class="custom-check-holder">
                                                            <h3 class="quote-filter-title">
                                                                Sort By
                                                                <span class="info-icn" data-container="body" data-toggle="popover" data-placement="top"
                                                                      data-content="The amount you pay before your health insurance plan begins to pay for the services you receive. Not everything you pay (such as your premium and copay) counts toward your deductible. For example, if your deductible is $1,000, your plan won't pay anything until you've met your $1,000 deductible for covered healthcare services subject to the deductible. Estimated Premium is based on a (Per Term Deductible)"></span>
                                                            </h3>
                                                            <div class="{% comment %}sort-by{% endcomment %}">
                                                                {% comment %}Sort by
                                                        <span class="custom-drop-down">
                                                            <span class="drop-text">{% if form_data.Payment_Option == '1' %}Monthly{% endif %} Premium</span>
                                                            <i class="fa fa-angle-down"></i>
                                                        </span>{% endcomment %}
                                                                <ul class="custom-radio" id="plan_sorting_options" data-status="loading">
                                                                    {% comment %}<li class="sorting_option selected" data-key="month" data-reverse="true">
                                                                <a href="javascript:void(0);">Plan Duration</a>
                                                            </li>{% endcomment %}
                                                                    <li class="sorting_option" data-key="Premium">
                                                                        <a href="javascript:void(0);">
                                                                            {% if form_data.Payment_Option == '1' %}Monthly{% endif %} Premium
                                                                        </a>
                                                                    </li>
                                                                    <li class="sorting_option" data-key="option">
                                                                        <a href="javascript:void(0);">Deductible</a>
                                                                    </li>
                                                                    {% comment %}<li class="sorting_option" data-key="Coinsurance_Percentage">
                                                                <a href="javascript:void(0);">Coinsurance</a>
                                                            </li>
                                                            <li class="sorting_option" data-key="out_of_pocket_value">
                                                                <a href="javascript:void(0);">Max Out of Pocket</a>
                                                            </li>
                                                            <li class="sorting_option" data-key="coverage_max_value">
                                                                <a href="javascript:void(0);">Policy Maximum</a>
                                                            </li>{% endcomment %}
                                                                </ul>
                                                            </div>
                                                        </div>
                                                    </div>
                                                {% endif %}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                        </div>

                        <div class="col-xs-12">
                            <div id="quote_plans-loading" style="display:none;text-align: center;margin-bottom: 30px">
                                <img src="{% static 'quotes/img/ajax-loader-stripe-002.gif' %}">
                            </div>
                            <div id="featured_plan_container"></div>
                            <div class="plan-list" id="month_plan_list">
                                <div class="qt-quote-loading-icon">
                                    <img width="80px" src="{% static 'quotes/img/ajax-loader.gif' %}">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    {% if ctx_app_url_exists %}
    {% include 'quotes/info-popup.html' %}
    {% endif %}

{% endblock container %}

{% block extra_js %}

{#<script src="//cdnjs.cloudflare.com/ajax/libs/numeral.js/2.0.6/numeral.min.js"></script>#}
{#<script src="https://cdnjs.cloudflare.com/ajax/libs/mustache.js/3.0.1/mustache.min.js"></script>#}
{#<script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>#}
{#<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>#}
<script src="{% static 'nhaquote_old/js/plugins/numeral.min.js' %}"></script>

<script id="stm_plan_template" data-plans="" type="x-tmpl-mustache">
    <div class="col-sm-6 col-md-4 qt-each-plan{% comment %}ms-row{% endcomment %}">
    <div class="h-100 mb-30"{% comment %}row{% endcomment %}>
        <div class="quote-container">
            <div class="">
                <div class="qt-plan-logo">
                    <img alt="[[Name]]" src="/static/quotes/img/stm-transparent/[[plan_name_for_img]].png"
                                class="carrier-logo-image">

                </div>
                 <hr>
                <div class="plan-single-info">
                    <div class="fee">
                        $[[actual_premium]]
                        [[^upfront]]
                        <span class="quote-plan-per-month">/mo</span>
                        <sup style="color:#fe8829">+fee</sup>
                        [[/upfront]]
                    </div>
                </div>
                <div class="plan-single-info">
                    <h4 class="quote-plan-details">
                        <a class="js-view-details1" href="/stm/plan/[[unique_url]]">
                            [[plan_name]]
                        </a>
                        </h4>
                </div>
                <div class="plan-single-info" style="margin-top: 10px; text-align: left">
                    <p class="deductible">Premium: $[[actual_premium]]</p>
                <div class="">
                    <p class="deductible">Enrollment Fee: $[[Enrollment_Fee]]</p>
                </div>
                <div class="deductible">
                [[^TelaDoc_Fee]]
                </div>
                <div class="">
                    <p class="deductible">Administrative Fee: $[[Administrative_Fee]]</p>
                </div>
                <div class="deductible">
                [[/TelaDoc_Fee]]
                </div>
                </div>
                <div class="plan-select-btn">
                    <a href="/stm/plan/[[unique_url]]">Select this Plan</a>
                </div>
            </div>
        </div>
    </div>
</div>
</script>
<script id="anc_plan_template_usa_dental" data-plans="" type="x-tmpl-mustache">
    <div class="col-sm-6 col-md-4 qt-each-plan{% comment %}ms-row{% endcomment %}">
    <div class="h-100 mb-30"{% comment %}row{% endcomment %}>
        <div class="quote-container">
            <div class="">
                <div class="qt-plan-logo">
                    <img alt="[[Name]]" src="/static/quotes/img/stm-transparent/[[plan_name_for_img]].png"
                            class="carrier-logo-image">

                </div>
                <hr>
                <div class="plan-single-info">
                    <div class="fee">
                        $[[actual_premium]]
                        [[^upfront]]
                        <span class="quote-plan-per-month">/mo</span>
                        <sup style="color:#fe8829">+fee</sup>
                        [[/upfront]]
                    </div>
                </div>
                <div class="plan-single-info">
                    <h4 class="quote-plan-details">
                        <a class="js-view-details1" href="/stm/plan/[[unique_url]]">
                            [[plan_name]]
                        </a>
                    </h4>
                </div>
                <div class="plan-single-info" style="margin-top: 10px; text-align: left">
                    <p class="deductible">Premium: $[[actual_premium]]</p>
                    <div class="">
                        <p class="deductible">Enrollment Fee: $[[Enrollment_Fee]]</p>
                    </div>
                    [[#Administrative_Fee]]
                     <div class="">
                        <p class="deductible">Administrative Fee: $[[Administrative_Fee]]</p>
                    </div>
                    [[/Administrative_Fee]]
                    [[#note]]
                    <div class="">
                        <p class="deductible">Note: [[note]]</p>
                    </div>
                    [[/note]]
                </div>
                <div class="plan-select-btn">
                    <a href="/stm/plan/[[unique_url]]">Select this Plan</a>
                </div>
            </div>
        </div>
    </div>
</div>
</script>

<script id="stm_plan_template_lifeshield" data-plans="" type="x-tmpl-mustache">
    <div class="col-sm-6 col-md-4 qt-each-plan{% comment %}ms-row{% endcomment %}" id="[[#featured_plan]]featured-premium-plan[[/featured_plan]]">
        <div class="h-100 mb-30"{% comment %}row{% endcomment %}>
            <div class="quote-container">
                <div class="">

                    <div class="qt-plan-logo">
                        <img alt="[[Name]]" src="/static/quotes/img/stm-transparent/[[plan_name_for_img]].png"
                             class="carrier-logo-image">

                    </div>
                     <hr>
                    <div class="plan-single-info">
                        <div class="fee">
                            $[[actual_premium]]
                            [[^upfront]]
                            <span class="quote-plan-per-month">/mo</span>
                            <sup style="color:#fe8829">+fee</sup>
                            [[/upfront]]
                        </div>
                    </div>
                    <div class="plan-single-info">
                        <h4 class="quote-plan-details">
                            <a class="js-view-details1" href="/stm/plan/[[unique_url]]">
                                [[plan_name]]
                            </a>
                            </h4>
                    </div>
                    <div class="plan-single-info" style="margin-top: 10px; text-align: left">
                        <p class="deductible">Deductible: $[[option]]
                            <span data-content="The amount you pay before your health insurance plan begins to pay for the services you receive. Not everything you pay (such as your premium and copay) counts toward your deductible. For example, if your deductible is $1,000, your plan won't pay anything until you've met your $1,000 deductible for covered healthcare services subject to the deductible. Estimated Premium is based on a (Per Term Deductible)"
                                  data-placement="top" data-toggle="popover" data-container="body" class="info-icon"
                                  data-original-title="" title=""><i class="fa fa-info-circle"
                                                                      aria-hidden="true"></i></span>
                        </p>
                        <p class="policy-max">
                            <a data-content="The maximum dollar amount that a health insurance company agrees to pay on behalf of a member for covered services during the course of the coverage period."
                               class="glossary-x js-popover-x" href="javascript:void(0);" data-toggle="popover"
                               data-placement="top" data-container="body">
                                $[[coverage_max_value]] Policy Max
                            </a>
                        </p>


                    <div class="">
                        <p class="deductible">Coinsurance: [[Coinsurance_Percentage]]%
                            <span data-content="Your share of costs for a covered service, typically after you meet your deductible and copayment charges. For example, once you meet your deductible, you might pay 20% and your health insurance plan pays 80%, based on the plan you choose. Once you have met your plan's annual out-of-pocket maximum, your plan pays 100% of the costs for covered services."
                                  data-placement="top" data-toggle="popover" data-container="body" class="info-icon"
                                  data-original-title="" title=""><i class="fa fa-info-circle"
                                                                     aria-hidden="true"></i></span>
                        </p>
                        <p class="policy-max">
                            <a class="js-glossary" href="javascript:void(0)">$[[copay]] [[copay_text]]</a>
                        </p>
                    </div>
                    <div class="">
                        <p class="deductible">Max Out of Pocket: $[[out_of_pocket_value]]
                            <span data-content="Your share of costs for a covered service, including your deductible. For example, once you meet your deductible, you pay 0% and your health insurance plan pays 100% up to $10,000; then 100% of the costs for covered services are paid thereafter, up to the plan maximum of $1,000,000."
                                  data-placement="top" data-toggle="popover" data-container="body" class="info-icon"
                                  data-original-title="" title=""><i class="fa fa-info-circle"
                                                                     aria-hidden="true"></i></span>
                        </p>
                        <p class="policy-max">
                            <a class="js-glossary" href="javascript:void(0)">$[[copay_2]] [[copay_2_text]]</a>
                        </p>
                    </div>
                    </div>
                    <div class="plan-select-btn">
                        <a href="/stm/plan/[[unique_url]]">Select this Plan</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    [[#featured_plan]]
        <div>
            {% comment %}showed only in featured plan{% endcomment %}
            <div id="best-seller-badge"></div>
        </div>
    [[/featured_plan]]
    </div>

</script>
<script type="text/javascript" src="{% static 'nhaquote_old/js/plugins/mustache.min.js' %}"></script>
<script>
if (!Array.prototype.filter) {
  Array.prototype.filter = function(fun/*, thisArg*/) {
    'use strict';
    if (this === void 0 || this === null) {
      throw new TypeError();
    }
    var t = Object(this);
    var len = t.length >>> 0;
    if (typeof fun !== 'function') {
      throw new TypeError();
    }
    var res = [];
    var thisArg = arguments.length >= 2 ? arguments[1] : void 0;
    for (var i = 0; i < len; i++) {
      if (i in t) {
        var val = t[i];
        if (fun.call(thisArg, val, i, t)) {
          res.push(val);
        }
      }
    }
    return res;
  };
}

// For showing preferred plans
if(performance.navigation.type === 2) {
            console.log("Back button detected, reloading page");
            location.reload(true);
}


</script>
<script>
$(function() {
    Mustache.tags = ['[[', ']]'];
    var stm_plan_template = $('#stm_plan_template').html();
    var stm_plan_template_lifeshield = $('#stm_plan_template_lifeshield').html();
    var anc_plan_template_usa_dental = $('#anc_plan_template_usa_dental').html();
    Mustache.parse(stm_plan_template);
    Mustache.parse(stm_plan_template_lifeshield);
    Mustache.parse(anc_plan_template_usa_dental);

    var action_url = '/get_plan_quote_data_ajax/';

    var $total_plan_count = $('#total_plan_count');
    var $plan_display_count = $('#plan_display_count');

    var $premium_total_plan_count = $('#premium_total_plan_count');
    var $deductible_total_plan_count = $('#deductible_total_plan_count');
    var $coinsurance_total_plan_count = $('#coinsurance_total_plan_count');
    var $oop_total_plan_count = $('#oop_total_plan_count');
    var $policy_max_total_plan_count = $('#policy_max_total_plan_count');


    /* filter callback functions start */
    function premium_filter_callback(ele) {
        if (typeof ele == 'string') {return false;}

        var start = Number(this.attr('data-filter0'));
        var end = Number(this.attr('data-filter1'));
        if (start == end) {return true;}

        var value = Number(ele.actual_premium);
        if (start <= value && value < end) return true;

        return false;
    }

    function deductible_filter_callback(ele) {
        if (typeof ele == 'string') {return false;}

        var value = Number(this.attr('data-value'));

        if (value == 0) return true;

        return value == Number(ele.option);
    }

    function coinsurance_filter_callback(ele) {
        if (typeof ele == 'string') {return false;}

        var value = this.attr('data-value');

        if (value == 'all') return true;

        return Number(value) == Number(ele.Coinsurance_Percentage);
    }

    function oop_filter_callback(ele) {
        if (typeof ele == 'string') {return false;}

        var start = Number(this.attr('data-filter0'));
        var end = Number(this.attr('data-filter1'));
        if (start == end) {return true;}

        var value = Number(ele.out_of_pocket_value);
        if (start <= value && value < end) return true;

        return false;
    }

    function policy_max_filter_callback(ele) {
        if (typeof ele == 'string') {return false;}

        var value = Number(this.attr('data-value'));

        if (value == 0) return true;

        return value == Number(ele.coverage_max_value);
    }

    function company_filter_callback(ele) {
        if (typeof ele == 'string') {return false;}
        var carriers = [];
        this.each(function(idx) {carriers.push($(this).attr('data-value'));});
        if (carriers.length == 0) return true;
        return $.inArray("" + ele.Plan_ID, carriers) != -1;
    }

    /* filter callback functions end */


    /* filter plan count functions start */
    function premium_count(plans) {
        var filtered_plans;

        filtered_plans = plans.filter(
                deductible_filter_callback,
                $('input[name="planDeductibleRange"]:checked')
        );
        filtered_plans = plans.filter(
                company_filter_callback,
                $('input[name="carrier"]:checked')
        );
        filtered_plans = filtered_plans.filter(
                coinsurance_filter_callback,
                $('input[name="planCoinsurance"]:checked')
        );
        filtered_plans = filtered_plans.filter(
                oop_filter_callback,
                $('input[name="oopMaxRange"]:checked')
        );
        filtered_plans = filtered_plans.filter(
                policy_max_filter_callback,
                $('input[name="planCoverageMax"]:checked')
        );

        $premium_total_plan_count.text(filtered_plans.length);

        $('.premium_filter_range_input').each(function(idx) {
            var $this = $(this);
            var fps = filtered_plans.filter(premium_filter_callback, $this);
            $('#premium_total_plan_count_' + $this.attr('data-filter0') + '_' + $this.attr('data-filter1')).text(fps.length);
            if (fps.length > 0) {
                $this.prop('disabled', false);
            } else {
                $this.prop('disabled', true);
            }
        });
    }

    function deductible_count(plans) {
        var filtered_plans;
        filtered_plans = plans.filter(
                premium_filter_callback,
                $('input[name="priceRange"]:checked')
        );
        filtered_plans = filtered_plans.filter(
                company_filter_callback,
                $('input[name="carrier"]:checked')
        );
        filtered_plans = filtered_plans.filter(
                coinsurance_filter_callback,
                $('input[name="planCoinsurance"]:checked')
        );
        filtered_plans = filtered_plans.filter(
                oop_filter_callback,
                $('input[name="oopMaxRange"]:checked')
        );
        filtered_plans = filtered_plans.filter(
                policy_max_filter_callback,
                $('input[name="planCoverageMax"]:checked')
        );

        $deductible_total_plan_count.text(filtered_plans.length);

        $('.deductible_filter_value_input').each(function(idx) {
            var $this = $(this);
            var fps = filtered_plans.filter(deductible_filter_callback, $this);
            $('#deductible_total_plan_count_' + $this.attr('data-value')).text(fps.length);
            if (fps.length > 0) {
                $this.prop('disabled', false);
            } else {
                $this.prop('disabled', true);
            }
        });
    }

    function coinsurance_count(plans) {
        var filtered_plans;
        filtered_plans = plans.filter(
                premium_filter_callback,
                $('input[name="priceRange"]:checked')
        );
        filtered_plans = filtered_plans.filter(
                deductible_filter_callback,
                $('input[name="planDeductibleRange"]:checked')
        );
        filtered_plans = filtered_plans.filter(
                oop_filter_callback,
                $('input[name="oopMaxRange"]:checked')
        );
        filtered_plans = filtered_plans.filter(
                policy_max_filter_callback,
                $('input[name="planCoverageMax"]:checked')
        );

        $coinsurance_total_plan_count.text(filtered_plans.length);

        $('.coinsurance_filter_value_input').each(function(idx) {
            var $this = $(this);
            var fps = filtered_plans.filter(coinsurance_filter_callback, $this);
            $('#coinsurance_total_plan_count_' + $this.attr('data-value')).text(fps.length);
            if (fps.length > 0) {
                $this.prop('disabled', false);
            } else {
                $this.prop('disabled', true);
            }
        });
    }

    function oop_count(plans) {
        var filtered_plans;
        filtered_plans = plans.filter(
                premium_filter_callback,
                $('input[name="priceRange"]:checked')
        );
        filtered_plans = filtered_plans.filter(
                company_filter_callback,
                $('input[name="carrier"]:checked')
        );
        filtered_plans = filtered_plans.filter(
                deductible_filter_callback,
                $('input[name="planDeductibleRange"]:checked')
        );
        filtered_plans = filtered_plans.filter(
                coinsurance_filter_callback,
                $('input[name="planCoinsurance"]:checked')
        );
        filtered_plans = filtered_plans.filter(
                policy_max_filter_callback,
                $('input[name="planCoverageMax"]:checked')
        );

        $oop_total_plan_count.text(filtered_plans.length);

        $('.oop_filter_range_input').each(function(idx) {
            var $this = $(this);
            var fps = filtered_plans.filter(oop_filter_callback, $this);
            $('#oop_total_plan_count_' + $this.attr('data-filter0') + '_' + $this.attr('data-filter1')).text(fps.length);
            if (fps.length > 0) {
                $this.prop('disabled', false);
            } else {
                $this.prop('disabled', true);
            }
        });
    }

    function policy_max_count(plans) {
        var filtered_plans;
        filtered_plans = plans.filter(
                premium_filter_callback,
                $('input[name="priceRange"]:checked')
        );
        filtered_plans = filtered_plans.filter(
                company_filter_callback,
                $('input[name="carrier"]:checked')
        );
        filtered_plans = filtered_plans.filter(
                deductible_filter_callback,
                $('input[name="planDeductibleRange"]:checked')
        );
        filtered_plans = filtered_plans.filter(
                coinsurance_filter_callback,
                $('input[name="planCoinsurance"]:checked')
        );
        filtered_plans = filtered_plans.filter(
                oop_filter_callback,
                $('input[name="oopMaxRange"]:checked')
        );

        $policy_max_total_plan_count.text(filtered_plans.length);

        $('.policy_max_filter_value_input').each(function(idx) {
            var $this = $(this);
            var fps = filtered_plans.filter(policy_max_filter_callback, $this);
            $('#policy_max_total_plan_count_' + $this.attr('data-value')).text(fps.length);
            if (fps.length > 0) {
                $this.prop('disabled', false);
            } else {
                $this.prop('disabled', true);
            }
        });
    }

    function company_count(plans) {
        var filtered_plans;
        filtered_plans = plans.filter(
                premium_filter_callback,
                $('input[name="priceRange"]:checked')
        );
        $('.company_filter_value_input').each(function(idx) {
            var $this = $(this);
            var fps = filtered_plans.filter(company_filter_callback, $this);
            $('#company_total_plan_count_' + $this.attr('data-value')).text(fps.length);
            if (fps.length > 0) {
                $this.prop('disabled', false);
            } else {
                $this.prop('disabled', true);
            }
        });
    }
    /* filter plan count function ends */


    function success_handler(json, sort_key, reverse_sort) {
        var filtered_plans;

        filtered_plans = json.monthly_plans.filter(
                premium_filter_callback,
                $('input[name="priceRange"]:checked')
        );
        filtered_plans = filtered_plans.filter(
                company_filter_callback,
                $('input[name="carrier"]:checked')
        );
        filtered_plans = filtered_plans.filter(
                deductible_filter_callback,
                $('input[name="planDeductibleRange"]:checked')
        );
        filtered_plans = filtered_plans.filter(
                coinsurance_filter_callback,
                $('input[name="planCoinsurance"]:checked')
        );
        filtered_plans = filtered_plans.filter(
                oop_filter_callback,
                $('input[name="oopMaxRange"]:checked')
        );
        filtered_plans = filtered_plans.filter(
                policy_max_filter_callback,
                $('input[name="planCoverageMax"]:checked')
        );

        /* sorting key */
        if (sort_key == undefined) {
            sort_key = $('.sorting_option.selected').attr('data-key');
            reverse_sort = $('.sorting_option.selected').attr('data-reverse');
        }
        /* sorting */
        filtered_plans.sort(function(a, b) {
            if (typeof a == 'string') {return -1;}
            if (typeof b == 'string') {return 1;}
            if (reverse_sort == 'true') {
                return - (Number(a[sort_key]) - Number(b[sort_key]));
            } else {
                return Number(a[sort_key]) - Number(b[sort_key]);
            }
        });

        /* removing previous plans */
        if (typeof json.monthly_plans[1] == 'object') {
            $('#month_plan_list').empty();
            $('#quote_plans-loading').fadeIn();
        }

        /* adding new plans */
        $.each(filtered_plans, function(idx, plan) {
            if (typeof plan != 'string') {
                var data = {
                    'Name': plan.Name,
                    'upfront': Number(plan.Payment_Option) == 2,
                    'plan_name_for_img': plan.plan_name_for_img,
                    'Premium': plan.Premium,
                    'actual_premium': plan.actual_premium,
                    'Enrollment_Fee': plan.Enrollment_Fee,
                    'TelaDoc_Fee': plan.TelaDoc_Fee,
                    'Administrative_Fee': plan.Administrative_Fee,
                    'unique_url': plan.unique_url,
                    'plan_name': plan.plan_name,
                    'featured_plan': plan.featured_plan,
                    'option': numeral(plan.option).format('0,0'),
                    'Coinsurance_Percentage': plan.Coinsurance_Percentage,
                    'out_of_pocket_value': numeral(plan.out_of_pocket_value).format('0,0'),
                    'coverage_max_value': numeral(plan.coverage_max_value).format('0,0'),
                    'copay': plan.copay, 'copay_text': plan.copay_text,
                    'copay_2': plan.copay_2, 'copay_2_text': plan.copay_2_text,
                    'note': plan.note
                };
                {#console.log(plan);#}
                if (plan.out_of_pocket_value) {
                    var rendered = Mustache.to_html(stm_plan_template_lifeshield, data);
                } else if(plan.Name == 'USA Dental' || plan.Name == 'Freedom Spirit Plus' ||
                    plan.Name == 'Safeguard Critical Illness') { {# TODO: for torsho: need plan type here #}
                    var rendered = Mustache.to_html(anc_plan_template_usa_dental, data);
                } else {
                    var rendered = Mustache.to_html(stm_plan_template, data);
                } //test

                //featured plan will be showed in top
                if(data.featured_plan){
                    //$("#month_plan_list").prepend(rendered);
                    $("#featured_plan_container").html(rendered);
                }
                else                    $("#month_plan_list").append(rendered);
            }
        });
        $('[data-toggle="popover"]').popover({trigger:'hover'});
        /* total plans */
        if (json.monthly_plans[json.monthly_plans.length - 1] == 'END') {
            $('#quote_plans-loading').fadeOut();
            $total_plan_count.text(json.monthly_plans.length - 2);
            if (json.monthly_plans.length == 2 && filtered_plans.length == 0) {
                $("#month_plan_list").html(
                        `<div class="alert alert-warning w100 text-center no-coverage-error-wrapper">
                            <h3 class="no-coverage-error"><i class="fa fa-info-circle" style="padding-right: 12px"></i>Sorry, We do not currently have any health insurance plans in your area.</h3>
                        </div>`
                );
            }
        } else if (json.monthly_plans.length >= 1) {
            $total_plan_count.text(json.monthly_plans.length - 1);
        }

        /* display plans */
        $plan_display_count.text(filtered_plans.length);

        /* filter plan count */
        premium_count(json.monthly_plans);
        company_count(json.monthly_plans);
        deductible_count(json.monthly_plans);
        coinsurance_count(json.monthly_plans);
        oop_count(json.monthly_plans);
        policy_max_count(json.monthly_plans);

        EndFiltering();
    }


    function error_handler() {
        console.log("Something wrong happened. Please try again after some time.");
        EndFiltering();
    }

    function discard_leftover_company (){
        console.log("Removing unused company filters");

        $plan_carrier_list_ul = $("#plan_carrier_list_ul");
        $plan_carrier_list_ul.children("li").each(function() {
            $input = $('input', this);
            var isDisabled = $input.prop('disabled');
            if (isDisabled === true){
                $(this).fadeOut();
            }
        });

    }

    {# We might have to change this function. #}
    function ajax_request_for_data(action_url, method, data, success_fn, error_fn) {
        $.ajax({
            url: action_url,
            beforeSend: function (xhr) {
                xhr.setRequestHeader("X-CSRFToken", $.cookie('csrftoken'));
            },
            data: data, type: method, dataType: 'json',
            success: function(json) {
                console.log("\nAjax : success");
                if (json.featured_stm_plan_quote) {
                    console.log("Feature: " + json.featured_stm_plan_quote);
                }
                if (json.monthly_plans[json.monthly_plans.length-1] != 'END' && json.monthly_plans[0] == 'START') {
                    console.info("There are more plans");
                    setTimeout(ajax_request_for_data, 2000, action_url,
                            'GET', {}, success_handler, error_handler);
                } else if (json.monthly_plans[0] == undefined) {
                    window.location = '/plans/';
                } else {
                    console.log("There are no more plans");

                    $('#stm_plan_template').attr('data-plans', JSON.stringify(json));
                    $('#plan_sorting_options').attr('data-status', 'done');     // Is not being used at the moment.
                    $('.filter_input').attr('data-status', 'done');

                    setTimeout(discard_leftover_company, 1000);
                }
                success_fn(json);
            },
            error: error_fn
        });
    }
    /* first time calling for plan data */
    ajax_request_for_data(action_url, 'GET', {}, success_handler, error_handler);

    /* sorting - after full load */
    /* Note that: there is no .sorting_option in plan_list_lim; It's a artifact from
       plan_list where there was option to sort plans */
    $('.sorting_option').on('click', function(e) {
        var status = $('#plan_sorting_options').attr('data-status');
        if (status == 'done') {
            var json = JSON.parse($('#stm_plan_template').attr('data-plans'));
            success_handler(json, $(this).attr('data-key'), $(this).attr('data-reverse'));
        }
    });


    /* filter - alter full load */
    $('.filter_input').on('click', function(e) {
        console.log("1288:\n List Full loaded: filtering");
        $('.overlay-loading').fadeIn();
        var _this = $(this);
        setTimeout(function() {
            if (_this.attr('data-status') == 'done') {
                console.log("1295:\nFiltering Done");
                var json = JSON.parse($('#stm_plan_template').attr('data-plans'));
                success_handler(json);
            }
        }, 1000);
    });

    function EndFiltering()
    {
         $('.overlay-loading').fadeOut();
    }
});
</script>


<script>
    $('#narrow-toggler-btn').click(function (e) {
        $('#filter-sort').slideToggle();
    })

    $('#close-fs').click(function (e) {
        $('#filter-sort').slideUp();
    })

    $(window).scroll(function () {
        if($(window).scrollTop() >  230){
            $('.quote-sort-bar').addClass('qt-sticky');
        } else {
            $('.quote-sort-bar').removeClass('qt-sticky');
        }

    });

</script>
{% endblock %}
